<!DOCTYPE html>
<html lang="en">
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-167285649-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167285649-1');
</script>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>krish-iyer.github.ioWeek #9</title><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Week #9" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hello everyone, here we are with another update on the project. Last week we have started with installing interrupt handler, so basically we will pass the address of a function while installing the interrupt handler, later when an interrupt occurs that function will be called." />
<meta property="og:description" content="Hello everyone, here we are with another update on the project. Last week we have started with installing interrupt handler, so basically we will pass the address of a function while installing the interrupt handler, later when an interrupt occurs that function will be called." />
<link rel="canonical" href="http://localhost:4000/haiku/2018/07/24/gsoc_2018_sdhci_mmc_driver-_week_9.html" />
<meta property="og:url" content="http://localhost:4000/haiku/2018/07/24/gsoc_2018_sdhci_mmc_driver-_week_9.html" />
<meta property="og:site_name" content="krish-iyer.github.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-07-24T19:03:36+05:30" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Week #9" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-07-24T19:03:36+05:30","datePublished":"2018-07-24T19:03:36+05:30","description":"Hello everyone, here we are with another update on the project. Last week we have started with installing interrupt handler, so basically we will pass the address of a function while installing the interrupt handler, later when an interrupt occurs that function will be called.","headline":"Week #9","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/haiku/2018/07/24/gsoc_2018_sdhci_mmc_driver-_week_9.html"},"url":"http://localhost:4000/haiku/2018/07/24/gsoc_2018_sdhci_mmc_driver-_week_9.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" type="text/css" href="/assets/main-light.css"></head>
<body>
    <div class="container"><header>
  <div class="menu">
    <ul><li><a href="/">/home</a></li><li><a href="/about/">/about</a></li><li><a href="/contact">/contact</a></li></ul>
  </div>
</header>
<main>
      <ul>
    <center><h1>Week #9</h1></center>
</ul>

<p>Hello everyone, here we are with another update on the project. Last week we have started with installing
interrupt handler, so basically we will pass the address of a function while installing the interrupt handler, later when an interrupt occurs that function will be called.</p>

<p>We opted for pin-based interrupt handler, which is one of the levels of interrupt handling. I have explained them in previous blogs.</p>

<h3 id="instructions-to-install-an-interrupt-handler">Instructions to install an interrupt handler:</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bus-&gt;irq = pciInfo-&gt;u.h0.interrupt_line; // driver needs to assign interrupt line to itself

if (bus-&gt;irq == 0 || bus-&gt;irq == 0xff){ // checking if right interrupt value is assigned
    return B_ERROR 

status = install_io_interrupt_handler(bus-&gt;irq, handler_function_name, bus, 0);

if(status != B_OK) // check if interrupt handler is successfully installed
    return B_ERROR
</code></pre></div></div>

<p>Currently interrupt handler function can handle following interrupts(Referred: <a href="https://github.com/freebsd/freebsd/blob/master/sys/dev/sdhci/sdhci.c#L2162">FreeBSD code</a>)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    // card presence interrupt
    // command interrupt
    // bus power interrupt
else
    // unexpected interrupt
</code></pre></div></div>

<p>So with this, we were successful in setting up the interrupt and it’s working pretty well as expected. Now the upcoming task is to issue the command to the card and read the response which is again giving timeout error. We have installed a DELAY() function for giving delays but still didn’t work.</p>

<p>We were trying to issue CMD0 which should reset the card registers and give the response at R1. There’s also an error interrupt recovery sequence mentioned in spec version 4.20 but again to implement that we need to issue few commands.</p>

<p>Next, we will be focusing on cleaning the code and getting it reviewed. After that, we will work on getting the responses for the corresponding commands.</p>

<p>My guess! it will most likely to be clocking issue and frequency config. I will try to dig more into it :).</p>


    </main><footer>
  
</footer>
</div>
  </body>
</html>
