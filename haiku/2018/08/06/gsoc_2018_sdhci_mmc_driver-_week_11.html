<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>krish-iyer.github.ioWeek #11</title><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Week #11" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Hello everyone, We are in the final week of GSoC’18 program and yesterday our code has successfully merged. It got crashed in the first build because we thought we would add the code but disable the build currently but we didn’t test the case when device manager will try to find the driver in a certain directory which we hardcoded at the time of loading the module. So we just changed it to an OR condition where it won’t be able to find the driver binary but still be able to boot the OS in any case." />
<meta property="og:description" content="Hello everyone, We are in the final week of GSoC’18 program and yesterday our code has successfully merged. It got crashed in the first build because we thought we would add the code but disable the build currently but we didn’t test the case when device manager will try to find the driver in a certain directory which we hardcoded at the time of loading the module. So we just changed it to an OR condition where it won’t be able to find the driver binary but still be able to boot the OS in any case." />
<link rel="canonical" href="http://localhost:4000/haiku/2018/08/06/gsoc_2018_sdhci_mmc_driver-_week_11.html" />
<meta property="og:url" content="http://localhost:4000/haiku/2018/08/06/gsoc_2018_sdhci_mmc_driver-_week_11.html" />
<meta property="og:site_name" content="krish-iyer.github.io" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-06T15:54:03+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Week #11" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-08-06T15:54:03+00:00","datePublished":"2018-08-06T15:54:03+00:00","description":"Hello everyone, We are in the final week of GSoC’18 program and yesterday our code has successfully merged. It got crashed in the first build because we thought we would add the code but disable the build currently but we didn’t test the case when device manager will try to find the driver in a certain directory which we hardcoded at the time of loading the module. So we just changed it to an OR condition where it won’t be able to find the driver binary but still be able to boot the OS in any case.","headline":"Week #11","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/haiku/2018/08/06/gsoc_2018_sdhci_mmc_driver-_week_11.html"},"url":"http://localhost:4000/haiku/2018/08/06/gsoc_2018_sdhci_mmc_driver-_week_11.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" type="text/css" href="/assets/main-light.css"></head>
<body>
    <div class="container"><header>
  <div class="menu">
    <ul><li><a href="/">/home</a></li><li><a href="/assets/Krishnan-Iyer-Resume.pdf" target="_blank" rel="noopener noreferrer">/cv</a></li><li><a href="/about/">/about</a></li><li><a href="/contact">/contact</a></li></ul>
  </div>
</header>
<main>
      <ul>
  <center><h1>Week #11</h1></center>
  <p style="text-align: center; font-style: italic; font-size: 0.9em;">August 6, 2018</p>
</ul>

<p>Hello everyone, We are in the final week of GSoC’18 program and yesterday our <a href="https://git.haiku-os.org/haiku/commit/?id=25b6a6f19b13680a759cffecebf60d0b7e76d3d3">code</a> has successfully <a href="https://review.haiku-os.org/#/c/haiku/+/318/">merged</a>. It got crashed in the first build because we thought we would add the code but disable the build currently but we didn’t test the case when device manager will try to find the driver in a certain directory which we <a href="https://github.com/krish-iyer/haiku/blob/sdhci_mmc_driver/src/system/kernel/device_manager/device_manager.cpp#L1899">hardcoded</a> at the time of loading the module. So we just changed it to an OR condition where it won’t be able to find the driver binary but still be able to boot the OS in any case.</p>

<p>I would like to elaborate where exactly the project is stuck now. In <a href="https://www.sdcard.org/downloads/pls/pdf/index.php?p=Part1_Physical_Layer_Simplified_Specification_Ver1.10.jpg&amp;f=Part1_Physical_Layer_Simplified_Specification_Ver1.10.pdf&amp;e=EN_P1110">Physical Layer spec version 1.10</a>  pg 97 and section 7.2 has a flow chart which clearly specifies the to issue the command and read the OCR value from which will be able to estimate the exact supported voltage value. So for the start, we need to issue
CMD0 which will reset the card. In pg 54 and section 4.7.4, they mentioned the command which is as follows.</p>

<table>
  <thead>
    <tr>
      <th>CMD Index</th>
      <th style="text-align: center">SPI Mode</th>
      <th style="text-align: right">Argument</th>
      <th>Resp</th>
      <th style="text-align: center">Abbreviation</th>
      <th style="text-align: right">Command Desp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CMD0</td>
      <td style="text-align: center">yes</td>
      <td style="text-align: right">none</td>
      <td>R1</td>
      <td style="text-align: center">GO_IDLE_STATE</td>
      <td style="text-align: right">resets the SD card</td>
    </tr>
  </tbody>
</table>

<p>So for this I did following things:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// As  mentioned in command register desciption in [SD host spec ver 1.00
command = SDHCI_RESPONSE_R1 | SDHCI_CMD_CRC_EN  | SDHCI_CMD_INDEX_EN | SDHCI_CMD_0;
</code></pre></div></div>

<p>But no response came up. Timeout error indicates that there should be some clocking issue. But I think 400kHZ is the ideal clock at which card should respond. For that again we read base clock value from the capabilities register and divided with the factor so that we get a value nearest to 400kHZ.</p>

<p>For this week I will be writing documentation and submitting the final evaluation. Feel free to review the code and share your views regarding the project :).</p>


    </main><footer>
  
</footer>
</div>
  </body>
</html>
